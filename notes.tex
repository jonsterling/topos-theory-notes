\documentclass{article}
\usepackage{local-macros}
\usepackage{tikz-cd}
\usepackage{microtype}
\usepackage{eulervm}
\usepackage{libertineRoman}
\usepackage{sectsty}
\allsectionsfont{\sffamily}

\newcommand\AreSubsetEq[1]{\FormatList{\IMode}{\subseteq}{#1}}
\newcommand\AIsEq[2]{\IMode{#1} &=\IMode{#2}}
\newcommand\Char[1]{\mathbf{char}_{#1}}
\newcommand\Cats{\mathbf{Cat}}
\newcommand\Sets{\mathbf{Set}}
\newcommand\Posets{\mathbf{Pos}}
\newcommand\OpCat[1]{{{#1}^{\mathsf{op}}}}
\newcommand\Hom[3]{\mathsf{Hom}_{#1} (#2, #3)}
\DeclareMathOperator\OpYoneda{\mathbf{y}}
\newcommand\Yoneda[1]{\OpYoneda({#1})}
\newcommand\Psh[1]{\widehat{#1}}
\newcommand\Sh[1]{\mathbf{Sh} (#1)}
\newcommand\IsSubobject[3]{\IMode{#1}\rightarrowtail\IMode{#2}:\IMode{#3}}
\newcommand\IsSubsetEq[2]{\IMode{#1}\subseteq\IMode{#2}}
\newcommand\One{\mathbf{1}}
\newcommand\Two{\mathbf{2}}
\newcommand\NotMember[2]{\IMode{#1}\not\in\IMode{#2}}
\newcommand\IsSieve[2]{\IMode{#2}\ \mathit{sieve}_{\IMode{#1}}}
\newcommand\IsEquiv[2]{\IMode{#1}\cong\IMode{#2}}
\newcommand\IsNotEq[2]{\IMode{#1}\not=\IMode{#2}}
\newcommand\AreEq[1]{\FormatList{\IMode}{=}{#1}}
\newcommand\JAtomic{J_{\mathsf{at}}}
\newcommand\JDense{J_{\mathsf{dense}}}
\newcommand\Emb[1]{\lfloor{#1}\rfloor}
\newcommand\ArrId[1]{\mathsf{id}_{#1}}
\newcommand\Forces[2]{\IMode{#1}\Vdash\IMode{#2}}
\newcommand\INJ{\mathbf{Inj}}
\newcommand\IsInh[1]{\IMode{#1}\ \mathit{inhabited}}
\DeclareMathOperator{\Sheafify}{\mathbf{a}}
\newcommand\AreAdjoint[1]{\FormatList{\IMode}{\dashv}{#1}}
\newcommand\AOf[2]{\IMode{#1}&:\IMode{#2}}
\newcommand\magicwand{\mathrel{-\mkern-6mu*}}
\newcommand\newname{\reflectbox{\ensuremath{\mathsf{N}}}} 
\newcommand\Plus[1]{{#1}^+}
\newcommand\PlusPlus[1]{{#1}^{++}}

\newcommand\Mono[2]{#1\rightarrowtail{#2}}
\newcommand\True{\mathsf{true}}
\newcommand\MkSet[1]{\{#1\}}
\newcommand\Pow[1]{\mathcal{P} (#1)}
\newcommand\Dom[1]{\vert{#1}\vert}
\newcommand\Sub[1]{\mathsf{Sub} (#1)}
\newcommand\Entails[2]{\IMode{#1}\leq\IMode{#2}}
\newcommand\IsMono[2]{\Mono{\IMode{#1}}{\IMode{#2}}}
\newcommand\IsEqOf[3]{\IMode{#1}=\IMode{#2}:\IMode{#3}}
\newcommand\Sim[2]{\IMode{#1}\sim\IMode{#2}}
\newcommand\Zero{\mathbf{0}}



\title{Notes on topos theory}
\author{Jon Sterling}
\affil{Carnegie Mellon University}
\date{}

\begin{document}
\maketitle

In the subjectivization of mathematical objects, the activity of a
scientist centers on the artificial delineation of their
characteristics into \emph{definitions} and \emph{theorems}. Depending
on the ends, different delineations will be preferred; in these notes,
we prefer to work with concise and memorable definitions constituted
from a common body of semantically rich building blocks, and treat
alternative characterizations as theorems.

Texts in category theory are often written for mathematicians who
are already competent in areas of math which are far more complex than
category theory; as a result, it is very common to immediately unfold
an object into a purely analytic muddle, or to saddle it with
historically-relevant baggage from neighboring fields (e.g.\ defining
``sheaves of abelian groups'' without defining even presheaves or
sheaves in general).

This is, in the author's view, a confounding of two important
processes in the development of mathematical science: the historical
process and the conceptual process. The latter is synthesized over
time through a \emph{sanitization} of history using hindsight as a
weapon, a scientifically necessary substitution of dialectics for
chronology.

\paragraph{Other texts}
To learn toposes and sheaves thoroughly, the reader is directed to
study Mac Lane and Moerdijk's excellent and readable \emph{Sheaves in
  Geometry and Logic}~\cite{maclane-moerdijk:1992}; also recommended
as a reference is the \emph{Stacks
  Project}~\cite{stacks-project}. These notes serves only as a
\emph{supplement} to the existing material.

\paragraph{Acknowledgments}

I am grateful to Jonas Frey, Pieter Hofstra, Bas Spitters and many
others for explaining aspects of category theory and topos theory to
me, and for putting up with my ignorance. All the errors in these
notes are mine alone.


\section{Toposes for concepts in motion}

Do mathematical \emph{concepts} vary over time and space? This
question is the fulcrum on which the contradictions between the
competing ideologies of mathematics rest. Let us review their answers:
\begin{description}
\item[Platonism] No.
\item[Constructivism] Maybe.
\item[Intuitionism] Necessarily, but space is just an abstraction of
  time.
\item[Vulgar constructivism] No.\footnote{I mean, of course, the Markov school.}
\end{description}

Brouwer's radical intuitionism was the first conceptualization of
mathematical activity which took a \emph{positive} position on this
question; the incompatibility of intuitionism with classical
mathematics amounts essentially to the fact that they take opposite
positions as to the existence of mathematical objects varying over
time.

Constructivism, as exemplified by Bishop~\cite{bishop:1967} takes a
more moderate position: we can neither confirm nor deny the variable
character of mathematical concepts. In this way, mathematics in
Bishop's sense is simultaneously the mathematics of \emph{all} forms
of variation, including the chaotic (classical) form.

This dispute has been partly trivialized under the unifying
perspective of \emph{toposes},\footnote{That is, if we are content to
  temporarily ignore the matter of \emph{predicativity}; in practice,
  this can be dealt with using various notions of \emph{pretopos}.}
which allow the scientific study of mathematical systems and their
relationships, including \IMode{Platonism} (the \OMode{\emph{category
    of sets}}), \IMode{constructivism} (the \OMode{\emph{free
    topos}}), \IMode{intuitionism} (the \OMode{\emph{topos of sheaves
    over the universal spread}}) and \IMode{vulgar constructivism}
(the \OMode{\emph{effective topos}}).

Toposes have both a \emph{geometric} and a \emph{logical} character;
the geometric aspect was the first to be developed, in the form of
\emph{Grothendieck toposes}, which are universes of sets which vary
continuously over some (generalized) form of space. More generally,
the \emph{logical} aspect of topos theory is emphasized in Lawvere and
Tierney's notion of an elementary topos, an abstract and axiomatic
generalization of Grothendieck's concept.

These two aspects of topos theory go hand-in-hand: whilst the laws of
an elementary topos are often justified by appealing to their
realization in a Grothendieck topos, it is frequently easier to
understand the complicated and fully analytic definitions of objects
in a Grothendieck topos by relating them to their logical
counterparts. We will try and appeal to both the geometric and the
logical intuitions in this tutorial where possible.

\section{Presheaves and presheaf toposes}
Presheaves are the simplest way to capture mathematical objects which
vary over a category $\Of{\mathbb{C}}{\Cats}$.

\begin{definition}[Presheaf]
  A presheaf on $\Of{\mathbb{C}}{\Cats}$ is a functor
  $\Of{\mathcal{F}}{\OpCat{\mathbb{C}}\to\Sets}$.
\end{definition}

Unfolding definitions, this means that for every object
$\Of{\Psi}{\mathbb{C}}$, we have a set
$\Of{\mathcal{F}(\Psi)}{\Sets}$; moreover, for any morphism
$\Of{\psi}{\Hom{\mathbb{C}}{\Phi}{\Psi}}$, we have an induced
\emph{restriction} map
$\Of{\mathcal{F}(\psi)}{\mathcal{F}(\Psi)\to \mathcal{F}(\Phi)}$ which preserves
identities and composition.
%
The presheaves on $\mathbb{C}$ form a category, which we will call
$\Of{\Psh{\mathbb{C}}}{\Cats}$.  When the presheaf
$\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$ is understood from context, we
will write $\IBox{\Of{m\cdot \psi}{\mathcal{F}(\Phi)}}$ for
$\OMode{\mathcal{F}(\psi)(m)}$.

\begin{definition}[Yoneda embedding]
  We have a full and faithful functor
  $\Of{\OpYoneda}{\mathbb{C}\to\Psh{\mathbb{C}}}$ called the
  \emph{Yoneda embedding}, which is defined as follows:
  \[
    \Define{
      \Yoneda{\Psi}
    }{
      \Hom{\mathbb{C}}{-}{\Psi}
    }
  \]
  A functor which is isomorphic to $\Yoneda{\Psi}$ is called
  \emph{representable} by $\Psi$.
\end{definition}

\begin{definition}[Sieve]
  A sieve on an object $\Of{\Psi}{\mathbb{C}}$ is a subfunctor of the
  presheaf represented by $\Psi$, i.e.\
  $\IsSubobject{S}{\Yoneda{\Psi}}{\Psh{\mathbb{C}}}$.\footnote{Usually, an alternative
    definition is given in terms of ``sets of arrows closed under
    precomposition'', but we prefer a definition with fewer moving
    parts. In practice it will be useful to use the alternative
    definition when reasoning.}
%
  In particular, a sieve on $\Psi$ picks out \emph{functorially} a
  collection of arrows ending in $\Psi$; the \emph{maximal sieve} is
  $\Yoneda{\Psi}$ itself, which chooses all arrows ending in $\Psi$.
\end{definition}

Accordingly, will write $\IBox{\IsSieve{\Psi}{S}}$ to mean
$\OBox{\IsSubobject{S}{\Yoneda{\Psi}}{\Psh{\mathbb{C}}}}$.

\subsection{Sieves and subobjects}

In classical set theory, every subset $\IsSubsetEq{A}{B}$ has a
\emph{characteristic function} $\Of{\Char{A}}{B\to \Two}$, defined as
follows:
\[
  \Define{
    \Char{A}(b)
  }{
    \begin{cases}
      0 &{\normalcolor\textbf{if } \Member{b}{A}}
      \\
      1 &{\normalcolor\textbf{if } \NotMember{b}{A}}
    \end{cases}
  }
\]

In toposes, there is always an object analogous to $\Two$, called the
\emph{subobject classifier}; this object is always written
$\Omega$. Following~\cite{maclane-moerdijk:1992}, a subobject
classifier is a monomorphism $\Of{\True}{\Mono{\One}{\Omega}}$ which for any
monomorphism $\Of{f}{\Mono{A}{B}}$ induces a characteristic morphism
$\Of{\Char{f}}{B\to\Omega}$ such that the following diagram is a
pullback:
\[
  \begin{tikzcd}[sep=huge]
    \IMode{A}
    \arrow[r,"\IMode{!}"]
    \arrow[d, swap, rightarrowtail, "\IMode{f}"]
    &
    \IMode{\One}
    \arrow[d, rightarrowtail,"\IMode{\True}"]
    \\
    \IMode{B}
    \arrow[r, dashed, swap, "\OMode{\Char{f}}"]
    &
    \IMode{\Omega}
  \end{tikzcd}
\]

In the category of sets, the subobject classifier is simply the
two-element set; its construction in a presheaf topos is more
complicated, essentially because it must be made to respect the fact
that the objects under consideration are ``in motion''.

\paragraph{The subobject classifier in a presheaf topos}

The subobject classifier in a presheaf topos is defined using
\emph{sieves}:
\begin{align*}
  \ADefine{
    \Omega(\Psi)
  }{
    \MkSet{
      S \mid \OBox{\IsSieve{\Psi}{S}}
    }
  }
  \\
  \ADefine{
    (S\cdot\IBox{\Of{\psi}{\Phi\to\Psi}})(X)
  }{
    \MkSet{
      \OBox{
        \Of{\phi}{X\to\Phi}
      }
      \mid
      \OBox{
        \Member{\psi\circ\phi}{S(X)}
      }
    }
  }
  \\
  \ADefine{
    \True_\Psi
  }{
    \Yoneda{\Psi}
  }
\end{align*}

\begin{remark}
  It may not be immediately clear why the subobject classifier is
  defined in this way: what does the collection of sieves have to do
  with $\Two$ in (classical) set theory? One way to understand what is
  happening is to observe how $\Omega$ behaves when our base category
  $\mathbb{C}$ is \emph{chaotic}, in the sense that every two objects
  is connected by exactly one arrow.
%
  If $\mathbb{C}$ is chaotic, then either
  $\IsEq{\Yoneda{\Psi}(\Phi)}{\One}$ for every
  $\Of{\Phi}{\mathbb{C}}$; therefore, the judgment
  $\IBox{\IsSieve{\Psi}{S}}$ comes out to mean simply
  $\OBox{\IsSubsetEq{S(\Psi)}{\One}}$,
  i.e. $\Member{S(\Psi)}{\Pow{\One}}$. Therefore,
  $\IsEq{\Omega(\Psi)}{\Pow{\One}}=\IMode{\Two}$. An analogous
  argument can be made in case $\mathbb{C}$ is a groupoid.
\end{remark}

\paragraph{Understanding $\Omega$ using Yoneda's Lemma as a weapon}
Much like how a candidate construction of the exponential in a functor
category can be hypothesized using an insight from the Yoneda Lemma,
it is also possible to apply the same technique to the construction of
the subobject classifier in a presheaf category.

Based on our intention that $\Omega$ shall be a construction of the
subobject classifier, we want to identify maps $\Of{\phi}{X\to\Omega}$
with subobjects of $\Of{X}{\Psh{\mathbb{C}}}$, i.e.\ we intend to
exhibit a bijection $\IsEquiv{[X,\Omega]}{\Sub{X}}$.
%
Now, cleverly choose $\Define{X}{\Yoneda{U}}$: then we have
$\IsEquiv{[U,\Omega]}{\Sub{X}}$. But the Yoneda Lemma says that
$\IsEquiv{[\Yoneda{U},\Omega]}{\Omega(U)}$! Therefore, we may take as
a scientific hypothesis the definition
$\Define{\Omega(U)}{\Sub{\Yoneda{U}}}$. It remains to show that this
definition exhibits the correct properties (exercise for the reader).

\section{Generalized topologies}

Let us remark that so far, we have described via presheaves a notion
of \emph{variable set} which requires only functoriality; in case we
are varying over a poset, this corresponds to \emph{monotonicity} in
Kripke models. We will now consider a notion of set which varies
\emph{continuously}, a property which corresponds to \emph{local
  character} in Beth models.

The definition of a Grothendieck topology is quite complicated, but we
will show how to understand it conceptually using the logical
perspective that we alluded to in the introduction.

\begin{definition}[Grothendieck Topology~\cite{maclane-moerdijk:1992}]
  A Grothendieck topology is, for each object $\Of{\Psi}{\mathbb{C}}$,
  a collection $J(\Psi)$ of sieves on $\Psi$; a sieve $\Member{S}{J(\Psi)}$
  is called a \emph{covering sieve}. To be called a topology, the
  predicate $J$ must be closed under the following rules:
  \[
    \infer[\textit{maximality}]{
      \Member{\Yoneda{\Psi}}{J(\Psi)}
    }{
    }
    \qquad
    \infer[\textit{stability}]{
      \Member{S\cdot\psi}{J(\Phi)}
    }{
      \Member{S}{J(\Psi)}
      &
      \Of{\psi}{\Hom{\mathbb{C}}{\Phi}{\Psi}}
    }
  \]
  \[
    \infer[\textit{transitivity}]{
      \Member{R}{J(\Psi)}
    }{
      \Member{S}{J(\Psi)}
      &
      \IsSieve{\Psi}{R}
      &
      \forall\Member{\psi}{S(\Phi)}.\ \Member{R\cdot\psi}{J(\Phi)}
    }
  \]
\end{definition}

The above rules seem fairly poorly-motivated at first; however, it is
easy to understand their purpose when one considers the \emph{logical}
perspective. First, one should recognize that the \emph{stability} law
above is a disguised form of functoriality for $J$: that is, it
ensures that $J$ itself be a presheaf, namely, a subobject of
$\Omega$.

Now, every subobject induces a characteristic map into $\Omega$, and
it turns out that it will be far more informative to ignore the
analytic aspects of $J$ and focus only on the properties of its
characteristic map $\Define{\IBox{\Of{j}{\Omega\to\Omega}}}{\Char{J}}$:
\[
  \begin{tikzcd}[sep=huge]
    \IMode{J}
    \arrow[r,"\IMode{!}"]
    \arrow[d,rightarrowtail]
    &
    \IMode{\One}
    \arrow[d,rightarrowtail, "\IMode{\True}"]
    \\
    \IMode{\Omega}
    \arrow[r,swap,dashed,"\textstyle\Define{j}{\Char{J}}"]
    &
    \IMode{\Omega}
  \end{tikzcd}
\]

This perspective, to be developed in the next section, is justified by
the fact that in a topos, subobjects are completely determined by
their characteristic maps.

\subsection{The logical view}

\begin{definition}[Lawvere-Tierney Operator]\label{def:lawvere-tierney}
The characteristic map $\Of{j}{\Omega\to\Omega}$ of the Grothendieck
Topology $\Mono{\IMode{J}}{\IMode{\Omega}}$ is called a
\emph{Lawvere-Tierney topology / local
  operator}~\cite{maclane-moerdijk:1992} or a
\emph{nucleus}~\cite{jacobs:1999}, and exhibits the following
characteristics:
\begin{gather}
  \IsEq{j\circ\True}{\True}
  \label{eq:preserves-true}
  \\
  \IsEq{j\circ j}{j}
  \label{eq:idempotency}
  \\
  \IsEq{j\circ\land}{\land\circ(j\times j)}
  \label{eq:preserves-meets}
\end{gather}
\end{definition}

In other words, $j$ is an idempotent cartesian monad in the internal
logic of the topos. There is, however, a better-motivated way to state
these laws which makes more sense from a logical perspective; in
particular, axiom~\ref{eq:preserves-meets} can be replaced with the
more intuitive \emph{monotonicity} condition that $j$ shall preserve
entailment:
\begin{equation}
  \Entails{p}{q}\Rightarrow\Entails{j(p)}{j(q)}
  \tag{3.3*}
  \label{eq:monotonicity}
\end{equation}

\begin{proof}
  ($\Rightarrow$) Suppose $\IsEq{j\circ\land}{\land\circ(j\times j)}$
  and $\Entails{p}{q}$. We need to show that $\Entails{j(p)}{j(q)}$;
  first, observe that it suffices to show that
  $\IsEq{j(p)\land j(q)}{j(p)}$. Because $j$ preserves meets, this is
  the same as $\IsEq{j(p\land q)}{j(p)}$; but $\IsEq{p\land q}{p}$,
  because $\Entails{p}{q}$.\footnote{Thanks to Danny Gratzer for
    suggesting this argument.}

  ($\Leftarrow$) Suppose that $j$ preserves entailment; we need to
  show that it preserves meets. To show that
  $\Entails{j(p\land q)}{j(p)\land j(q)}$, it suffices to show both
  $\Entails{j(p\land q)}{j(p)}$ and $\Entails{j(p\land q)}{j(q)}$;
  these obtain respectively from the fact that $\Entails{p\land q}{p}$
  and $\Entails{p\land q}{q}$. Next, we have to show that
  $\Entails{j(p)\land j(q)}{j(p\land q)}$; this follows from
  idempotency and monotonicity.
\end{proof}

\paragraph{Relating the logical and the geometric views}

Each of the rules for a Grothendieck topology corresponds to an
intuitive logical requirement: \emph{maximality}, i.e.\ the inclusion
of represented functors as covers, corresponds to the requirement that
our local operator shall preserve truth; \emph{stability} corresponds
to the requirement that $J$ shall in fact be a presheaf; the
\emph{transitivity} law corresponds exactly to
axioms~\ref{eq:idempotency} and~\ref{eq:monotonicity}, composed to
form the Kleisli extension for the monad $j$.

\begin{remark}[Pretopologies and coverages]
  There are several other ways to define some form of topology on a
  category, including \emph{coverages} and \emph{pretopologies}. In
  some contexts, these are allegedly easier to work with, but they
  tend to impose extra requirements on the category $\mathbb{C}$, and
  end up obscuring the crisp logical character of topologies and their
  correspondence with modal operators. From a logical perspective, the
  concept of a ``pretopology'' is essentially meaningless, so we
  prefer to avoid it.
\end{remark}

\subsection{Covering sieves as a poset}
\newcommand\IsLEQ[2]{\IMode{#1}\leq\IMode{#2}}

As we have described it, the covering sieves $J(\Psi)$ form a set, but
we can also regard $J(\Psi)$ as a poset by imposing the inclusion
order.

\begin{definition}[Filtered poset]
  A poset $\Of{P}{\Posets}$ is \emph{filtered} or \emph{directed} iff
  it is inhabited, and every pair of elements $\Of{m,n}{P}$ has an
  upper bound $\Of{l}{P}$, i.e.\ both $\IsLEQ{m}{l}$ and
  $\IsLEQ{n}{l}$.
\end{definition}


\begin{lem}[Covers are cofiltered]\label{lem:covering-sieves-filtered}
  For every $\Of{\Psi}{\mathbb{C}}$ the poset $\Of{J(\Psi)}{\Posets}$
  is \emph{cofiltered}, i.e.\ the opposite poset
  $\Of{\OpCat{J(\Psi)}}{\Posets}$ is filtered.
\end{lem}
\begin{proof}
  First, $J(\Psi)$ is inhabited by the maximal sieve $\Yoneda{\Psi}$,
  so it suffices to show that for any $\Of{S,T}{J(\Psi)}$ we can
  exhibit $\Of{S\cap T}{J(\Psi)}$ such that $\IsSubsetEq{S\cap T}{S}$
  and $\IsSubsetEq{S\cap T}{T}$. The construction of this intersection
  is clear, but we need to show that it is still a cover.

  At an analytic level, we can use the \emph{transitivity} axiom of a
  Grothendieck topology to show that the intersection of two covering
  sieves is a covering sieve. But it is more clear and less
  bureaucratic to work internally, using
  axiom~\ref{eq:preserves-meets} for a Lawvere-Tierney topology which
  states that $\IsEq{j\circ\land}{\land\circ(j\times j)}$.
%
  Because $\Of{j}{\Omega\to\Omega}$ is the characteristic map of the
  subobject $\IsSubobject{J}{\Omega}{\Psh{\mathbb{C}}}$, this really
  means that
  $\IBox{\Member{S\cap
      T}{J}}\Leftrightarrow\IBox{\Member{S}{J}\land\Member{T}{J}}$
  from an internal perspective, which is precisely what we were trying
  to prove.
\end{proof}

\section{Sheaves on a site}

A \emph{site} is a category $\mathbb{C}$ together with a topology
$\IsSubobject{J}{\Omega}{\Psh{\mathbb{C}}}$. We will now
proceed to give perspicuous definitions of what it means for a
presheaf $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$ to be \emph{separated} and a
\emph{sheaf} respectively.

There are many different definitions of separated presheaves and
sheaves, most of which involve a number of complicated analytic
conditions, or that some diagram shall commute; we prefer to give an
equivalent, simpler definition (which is usually presented as a
\emph{theorem}).

First, observe that for any $\IsSieve{\Psi}{S}$, we have a canonical
function between hom-sets
$\Of{i_S^*}{[\Yoneda{\Psi},\mathcal{F}]\to [S,\mathcal{F}]}$
as follows:
\[
  \begin{tikzcd}[sep=huge]
    \IMode{\Yoneda{\Psi}}
    \arrow[r, "\IMode{m}"]
    &
    \IMode{\mathcal{F}}
    \\
    \IMode{S}
    \arrow[u,rightarrowtail,"\IMode{i_S}"]
    \arrow[ur,swap,dashed,"\OMode{i_S^*m}"]
  \end{tikzcd}
\]

\begin{definition}
  The presheaf $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$ is
  \emph{separated} iff for every $\IsSieve{\Psi}{S}$, the induced map
  between hom-sets
  $\Of{i_S^*}{[\Yoneda{\Psi},\mathcal{F}]\to[S,\mathcal{F}]}$ is a
  monomorphism. $\mathcal{F}$ is a \emph{sheaf} iff this map is also
  an isomorphism.
\end{definition}

It is worth taking a moment to cultivate some insight as to what is
going on here. First, recall that by the Yoneda lemma, we can identify
elements of $\mathcal{F}(\Psi)$ with natural transformations from the
maximal sieve, i.e.\ $[\Yoneda{\Psi},\mathcal{F}]$. So, sheafhood for
$\mathcal{F}$ is really saying that as far as $\mathcal{F}$ is
concerned, the elements of $\mathcal{F}(\Psi)$ can be identified with
natural transformations from \emph{any} sieve that covers $\Psi$, not
just the maximal one.

\begin{definition}[Matching families and amalgamations]
  A natural transformation $\Of{\mathfrak{m}}{[S,\mathcal{F}]}$ for
  $\Member{S}{J(\Psi)}$ is usually called a \emph{matching family} for
  $S$; then, the member of $\mathcal{F}(\Psi)$ which is determined by the
  sheaf-induced isomorphism (and the Yoneda lemma) is called an
  \emph{amalgamation}.
\end{definition}

\begin{notation}
  As a matter of convention, we will use Latin letters
  $\IMode{m},\IMode{n},\ldots$ to range over elements of a presheaf,
  and German letters
  $\IMode{\mathfrak{m}},\IMode{\mathfrak{n}},\ldots$ to range over
  matching families for a presheaf.
\end{notation}


\section{Sheafification: the essence of toposes}

For any Grothendieck topology
$\IsSubobject{J}{\Omega}{\Psh{\mathbb{C}}}$, there is a canonical way
to turn a presheaf on $\mathbb{C}$ into a sheaf on the site
$(\mathbb{C},J)$. Later on, we will see that this is actually this can
actually be taken as \emph{definitive} without explicitly invoking
Grothendieck (or Lawvere-Tierney) topologies, exposing the principal
contradiction of sheaf theory as the adjunction induced by a \emph{lex
  reflective subcategory} of a topos.

To begin with, we will exhibit the $J$-sheaves as a lex reflective
subcategory of the topos $\Psh{\mathbb{C}}$ in the sense that we have
a geometric morphism
$\AreAdjoint{\IBox{\Of{\Sheafify}{\Psh{\mathbb{C}}}\to
    \Sh{\mathbb{C},J}},\IBox{\Of{\iota}{\Sh{\mathbb{C},J}\hookrightarrow\Psh{\mathbb{C}}}}}$,
where $\iota$ is the (full and faithful) inclusion of sheaves into
presheaves and $\Sheafify$ is a ``sheafification'' functor.

Sheafification in presheaf toposes is obtained from the iterated
application of something called ``Grothendieck's plus construction'',
which we define below, fixing a presheaf $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$:
\begin{align*}
  \AOf{
    \Plus{(-)}
  }{
    \Psh{\mathbb{C}}\to\Psh{\mathbb{C}}
  }
  \\
  \ADefine{
    \Plus{\mathcal{F}}(\Psi)
  }{
    \int^{\Of{S}{\OpCat{J(\Psi)}}}
    [S,\mathcal{F}]
  }
  \\
  \ADefine{
    (S,\mathfrak{m})\cdot\IBox{\Of{\psi}{\Phi\to\Psi}}
  }{
    (S\cdot\psi, \mathfrak{m}\circ (\psi\circ-))
  }
\end{align*}
In the above colimiting construction, we write $J(\Psi)$ for the
\emph{poset} of covering sieves on $\Psi$.

In other words, the \emph{plus construction} for a presheaf replaces
its elements by covering sieves equipped with matching families:
conceptually, this means equipping a presheaf with ``formal
amalgamations''. We will see that this process is remarkably
well-behaved.


\begin{lem}[Equality in $\Plus{\mathcal{F}}$]\label{lem:plus-construction-equality}
  The following are equivalent:
  \begin{enumerate}
  \item $\IsEqOf{(R,\mathfrak{m})}{(S,\mathfrak{n})}{\Plus{\mathcal{F}}(\Psi)}$
  \item $\Sim{(R,\mathfrak{m})}{(S,\mathfrak{n})}$, where
    $\sim$ is the smallest equivalence relation which relates
    $\IMode{(R,\mathfrak{m})}$ and $\IMode{(S,\mathfrak{n})}$ when $\IsSubsetEq{R}{S}$
    $\Member{\IBox{\Of{\psi}{\Phi\to\Psi}}}{R(\Phi)}$, we have
    $\IsEqOf{\mathfrak{m}(\psi)}{\mathfrak{n}(\psi)}{\mathcal{F}(\Phi)}$.
  \item There is a common refinement
    $\Member{\IBox{\IsSubsetEq{T}{R\cap S}}}{J(\Psi)}$ such that for
    all $\Member{\IBox{\Of{\psi}{\Phi\to\Psi}}}{T(\Phi)}$, we have
    $\IsEqOf{\mathfrak{m}(\psi)}{\mathfrak{n}(\psi)}{\mathcal{F}(\Phi)}$.
  \end{enumerate}
\end{lem}
\begin{proof}
  (1)~$\Leftrightarrow$~(2) is the definition of equality for a colimit in
  $\Sets$.
  % 
  (1)~$\Leftrightarrow$~(3) is an equivalent characterization of
  equality for a \emph{filtered} colimit, i.e.\ a colimit of a digram
  whose domain is a filtered category. We have shown that
  $\OpCat{J(\Psi)}$ is indeed filtered in
  Lemma~\ref{lem:covering-sieves-filtered}.
\end{proof}

In what follows, we will follow in the broad strokes the proofs given
in~\cite{maclane-moerdijk:1992}, but giving more detail and using a
more ``nuts-and-bolts'' style based on the view of sieves as
subfunctors and matching families as natural transformations.

\begin{thm}\label{thm:plus-separated}
  When $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$ is any presheaf, its plus
  construction $\Of{\Plus{\mathcal{F}}}{\Psh{\mathbb{C}}}$ is \emph{separated},
  i.e.\ for any sieve $\Member{S}{J(\Psi)}$ the precomposition map
  between hom-sets induced by
  $\Of{i_S}{S\rightarrowtail\Yoneda{\Psi}}$ is injective:
  \[
    \begin{tikzcd}[sep=huge]
      \IMode{[\Yoneda{\Psi},\Plus{\mathcal{F}}]}
      \arrow[r,tail,"\IMode{i_S^*}"]
      &
      \IMode{[S,\Plus{\mathcal{F}}]}
    \end{tikzcd}
  \]
\end{thm}
\begin{proof}
  Fix two matching families
  $\Of{\mathfrak{m}_1,\mathfrak{m}_2}{[\Yoneda{\Psi},\Plus{\mathcal{F}}]}$. We
  need to show that if
  $\IsEqOf{\mathfrak{m}_1\circ i_S}{\mathfrak{m}_2\circ
    i_S}{[S,\Plus{\mathcal{F}}]}$, then already
  $\IsEqOf{\mathfrak{m}_1}{\mathfrak{m}_2}{[\Yoneda{\Psi},\Plus{\mathcal{F}}]}$.
  
  By the Yoneda Lemma it suffices to prove only
  $\IsEqOf{m_1}{m_2}{\Plus{\mathcal{F}}(\Psi)}$ (defining
  $\Define{m_i}{\mathfrak{m}_i(\ArrId{\Psi})}$), and we can rewrite
  our assumption to say that for all $\Member{\psi}{S(\Phi)}$ we have
  $\IsEqOf{m_1\cdot\psi}{m_2\cdot\psi}{\Plus{\mathcal{F}}(\Phi)}$.

  Let
  $\Match{m_i}{(\IBox{\Member{T_i}{J(\Psi)}},\IBox{\Of{\mathfrak{n}_i}{[T_i,\mathcal{F}]}})}$;
  by Lemma~\ref{lem:plus-construction-equality}, our equality
  hypothesis is the same as to say that there exists common
  refinements $\IsSubsetEq{T_\psi}{(T_1\cdot\psi)\cap (T_2\cdot\psi)}$
  such that
  $\IsEqOf{\mathfrak{n}_1(\psi\circ\phi)}{\mathfrak{n}_2(\psi\circ\phi)}{\mathcal{F}(X)}$
  for all $\Member{\IBox{\Of{\phi}{X\to\Psi}}}{T_\psi(X)}$.

  We need to show that there exists a common refinement
  $\IsSubsetEq{T}{T_1\cap T_2}$ such that for all
  $\Member{\IBox{\Of{\psi}{\Phi\to\Psi}}}{T(\Phi)}$, we have
  $\IsEqOf{\mathfrak{n}_1(\psi)}{\mathfrak{n}_2(\psi)}{\mathcal{F}(\Phi)}$. Now
  we will choose
  $\Define{T(X)}{\MkSet{\psi \circ \phi \mid
      \OBox{\Member{\psi}{S(\Phi)}}, \OBox{\Member{\phi}{T_\psi(X)}}}}$;
  clearly $\IsSubsetEq{T}{T_1\cap T_2}$. It remains to show the
  following:
  \begin{enumerate}
  \item $\Member{T}{J(\Psi)}$. Applying the \emph{transitivity} axiom
    for covering sieves with $\Member{S}{J(\Psi)}$, it suffices to
    show that for all $\Member{\psi}{S(\Phi)}$ we have
    $\Member{T\cdot\psi}{J(\Phi)}$. Observe that
    $\Match{(T\cdot\psi)(X)}{\MkSet{\phi\mid
        \OBox{\Member{\psi\circ\phi}{T(X)}}}}$, i.e.\
    $\IsEq{T\cdot\psi}{T_\psi}$ which we have already assumed to be a
    cover.

  \item For all $\Member{\psi}{T(X)}$,
    $\IsEqOf{\mathfrak{n}_1(\psi)}{\mathfrak{n}_2(\psi)}{\mathcal{F}(X)}$. Unfolding
    things, this means that for all $\Member{\psi}{S(\Phi)}$ and
    $\Member{\phi}{T_\psi(X)}$ we must show
    $\IsEqOf{\mathfrak{n}_1(\psi\circ\phi)}{\mathfrak{n}_2(\psi\circ\phi)}{\mathcal{F}(X)}$,
    which we have already assumed.
  \end{enumerate}

\end{proof}

%In this section, we will assume without proof that lex reflective
%subcategories of presheaf toposes are themselves toposes.

\begin{thm}\label{thm:plus-sheaf}
  When $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$ is a separated presheaf, its plus
  construction $\Of{\Plus{\mathcal{F}}}{\mathbb{C}}$ is in fact a sheaf, i.e.\
  for any covering sieve $\Member{S}{J(\Psi)}$ the precomposition map
  between hom-sets induced by $\Of{i_S}{S\to\Yoneda{\Psi}}$ is
  bijective:
  \[
    \begin{tikzcd}[sep=huge]
      \IMode{[\Yoneda{\Psi},\Plus{\mathcal{F}}]}
      \arrow[r,leftrightarrow,"\IMode{i_S^*}"]
      &
      \IMode{[S,\Plus{\mathcal{F}}]}
    \end{tikzcd}
  \]
\end{thm}
\begin{proof}
  Fix a matching family $\Of{\mathfrak{m}_S}{[S,\Plus{\mathcal{F}}]}$; we need
  to exhibit a unique amalgamation
  $\OBox{\Member{m_S}{\Plus{\mathcal{F}}(\Psi)}}$ for $\mathfrak{m}_S$.
  %
  Because $\Plus{\mathcal{F}}$ is separated (Theorem~\ref{thm:plus-separated}),
  it suffices to merely exhibit \emph{some} such amalgamation, since
  its uniqueness will follow.

  First, observe that for each
  $\Member{\IBox{\Of{\psi}{\Phi\to\Psi}}}{S(\Phi)}$, the matching
  family gives a ``formal amalgamation'' for some covering sieve,
  i.e.\
  $\Match{\IBox{\Member{\mathfrak{m}_S(\psi)}{\Plus{\mathcal{F}}(\Phi)}}}{(T_\psi,\mathfrak{n}_\psi)}$
  for some $\Member{T_\psi}{J(\Phi)}$ and
  $\Of{\mathfrak{n}_\psi}{[T_\psi,\mathcal{F}]}$.
  
  Our task is to choose a suitable covering sieve
  $\OBox{\Member{R}{J(\Psi)}}$, together with a matching family
  $\OBox{\Of{\mathfrak{m}_R}{[R,\mathcal{F}]}}$ so that we can define
  $\Define{m_S}{(R,\mathfrak{m}_R)}$. Using a tactic similar to what
  we did in the proof of Theorem~\ref{thm:plus-separated}, choose:
  \[
    \Define{ R(X) }{ \MkSet{
        \begin{tikzcd}[ampersand replacement=\&,cramped]
          X \arrow[r,"\phi"] \& \Phi \arrow[r,"\psi"] \& \Psi
        \end{tikzcd}
        \mid
        \OBox{\Member{\psi}{S(\Phi)}},\OBox{\Member{\phi}{T_\psi(X)}}
      } }
  \]
  As in Theorem~\ref{thm:plus-separated}, we have
  $\Member{R}{J(\Psi)}$ by the transitivity axiom.
%
  Now we need to exhibit a matching family
  $\OBox{\Of{\mathfrak{m}_R}{[R,\mathcal{F}]}}$; first define its
  components as follows:
%
  \[
    \Define{ \mathfrak{m}_R^X(\psi\circ\phi) }{\mathfrak{n}_\psi^X(\phi)
    }
  \]
  
  \paragraph{Functionality}
  To show that the components of this matching family are well-defined
  (functional), fix $\IsEqOf{\phi_1}{\phi_2}{T_\psi(X)}$; we need to
  show that
  $\IsEqOf{\mathfrak{n}_\psi^X(\phi_1)}{\mathfrak{n}_\psi^X(\phi_2)}{\mathcal{F}(X)}$.

  By naturality of $\mathfrak{m}_S$, we have
  $\IsEqOf{(T_\psi\cdot\phi, \mathfrak{n}_\psi\cdot
    \phi)}{(T_{\psi\circ\phi},\mathfrak{n}_{\psi\circ\phi})}{\Plus{\mathcal{F}}(X)}$
  for all $\Of{\phi}{X\to\Phi}$; by
  Lemma~\ref{lem:plus-construction-equality}, this means that there is
  some family of covering sieves
  $\Member{\IBox{\IsSubsetEq{U_{\psi,\phi}}{(T_\psi\cdot\phi)\cap(T_{\psi\circ\phi})}}}{J(X)}$
  such that
  $\IsEqOf{\mathfrak{n}_\psi^\Upsilon(\phi\circ\chi)}{\mathfrak{n}_{\psi\circ\phi}^\Upsilon(\chi)}{\mathcal{F}(\Upsilon)}$
  for all
  $\Member{\IBox{\Of{\chi}{\Upsilon\to X}}}{U_{\psi,\phi}(\Upsilon)}$.

  Because covering sieves are closed under intersection, we also have
  a cover $\Member{U_{\psi,\phi_1}\cap U_{\psi,\phi_2}}{J(X)}$. Fixing
  $\Member{\IBox{\Of{\chi}{\Upsilon\to X}}}{(U_{\psi,\phi_1}\cap
    U_{\psi,\phi_2})(\Upsilon)}$, calculate:
  \begin{align*}
    \AIsEq{
      \mathfrak{n}_\psi^X(\phi_1)\cdot \chi
    }{
      \mathfrak{n}_\psi^\Upsilon(\phi_1\circ\chi)
    }
    \tag{naturality of $\mathfrak{n}_\psi$}
    \\
    \AIsEq{
    }{
      \mathfrak{n}_{\psi\circ\phi_1}^\Upsilon(\chi)
    }
    \tag{see above}
    \\
    \AIsEq{
    }{
      \mathfrak{n}_{\psi\circ\phi_2}^\Upsilon(\chi)
    }
    \tag{assumption}
    \\
    \AIsEq{
    }{
      \mathfrak{n}_\psi^\Upsilon(\phi_2\circ\chi)
    }
    \tag{see above}
    \\
    \AIsEq{
    }{
      \mathfrak{n}_\psi^X(\phi_2)\cdot\chi
    }
    \tag{naturality of $\mathfrak{n}_\psi$}
  \end{align*}
  Because $\mathcal{F}$ is separated, we have immediately our equality
  goal
  $\IsEqOf{\mathfrak{n}_\psi^X(\phi_1)}{\mathfrak{n}_\psi^X(\phi_2)}{\mathcal{F}(X)}$. Therefore,
  the components $\mathfrak{m}_R^X$ are well-defined, i.e.\ functional.

  \paragraph{Naturality}
  We still have to show that this candidate definition of
  $\mathfrak{m}_R$ is in fact a natural transformation. Fixing
  $\Of{\upsilon}{X\to\Upsilon}$, we have to show that the following
  diagram commutes:
  \[
    \begin{tikzcd}[sep=large]
      \IMode{S(\Upsilon)} \arrow[r,"\IMode{-\cdot\upsilon}"]
      \arrow[d,swap,"\IMode{\mathfrak{m}_R^\Upsilon}"] & \IMode{S(X)}
      \arrow[d,"\IMode{\mathfrak{m}_R^X}"]
      \\
      \IMode{\mathcal{F}(\Upsilon)} \arrow[r,swap,"\IMode{-\cdot\upsilon}"] &
      \IMode{\mathcal{F}(X)}
    \end{tikzcd}
    \qquad
    \begin{tikzcd}[sep=large]
      \IMode{\psi\circ\phi} \arrow[r,mapsto,"\IMode{-\cdot\upsilon}"]
      \arrow[d,mapsto,swap,"\IMode{\mathfrak{m}_R^\Upsilon}"] &
      \IBox{\OMode{\psi\circ\phi\circ\upsilon}}
      \arrow[d,mapsto,"\IMode{\mathfrak{m}_R^X}"]
      \\
      \IBox{\OMode{\mathfrak{n}_\psi(\phi)}}
      \arrow[r,mapsto,swap,"\IMode{-\cdot\upsilon}"] &
      \OBox{\IsEq{\mathfrak{n}_\psi(\phi)\cdot\upsilon}{\mathfrak{n}_\psi(\phi\circ\upsilon)}}
    \end{tikzcd}
  \]
  In this way, the naturality of $\mathfrak{m}_R$ reduces directly to
  the naturality of $\mathfrak{n}_\psi$. We may now define
  $\Define{m_S}{(R,\mathfrak{m}_R)}$.
%
  All that remains is to show that for all
  $\Member{\IBox{\Of{\psi}{\Phi\to\Psi}}}{S(\Phi)}$, we have
  $\IsEqOf{m_S\cdot\psi}{\mathfrak{m}_S(\psi)}{\Plus{\mathcal{F}}(\Phi)}$.

  First, observe that $\IsEq{R\cdot\psi}{T_\psi}$, and that
  $\AreEq{(\mathfrak{m}_R\cdot\psi)(\phi),\mathfrak{m}_R(\psi\circ\phi),\mathfrak{n}_\psi(\phi)}$,
  whence
  $\AreEq{m_S\cdot\psi,{(T_\psi,\mathfrak{n}_\psi)},\mathfrak{m}_S(\psi)}$.
\end{proof}

\begin{cor}
  For any presheaf $\Of{\mathcal{F}}{\Psh{\mathbb{C}}}$, the double application
  of the plus construction $\PlusPlus{\mathcal{F}}$ is a sheaf, i.e.\
  $\Of{\PlusPlus{\mathcal{F}}}{\Sh{\mathbb{C},J}}$.
\end{cor}
\begin{proof}
  By Theorems~\ref{thm:plus-sheaf} and~\ref{thm:plus-separated}.
\end{proof}



\begin{thm}[Sheafification]
  We are now equipped to show that the $J$-sheaves comprise a lex
  reflective subcategory of the presheaf topos $\mathbb{C}$, defining
  $\Define{\Sheafify{\mathcal{F}}}{\PlusPlus{\mathcal{F}}}$. In other words,
  \begin{enumerate}
  \item $\Of{\Sheafify}{\Psh{\mathbb{C}}\to\Sh{\mathbb{C},J}}$
    preserves finite limits.
  \item $\Of{\iota}{\Sh{\mathbb{C},J}\to\Psh{\mathbb{C}}}$ is full and
    faithful.
  \item We have the adjunction $\AreAdjoint{\Sheafify,\iota}$.
  \end{enumerate}
\end{thm}
\begin{proof}
\newcommand\Amalg[1]{\llparenthesis{#1}\rrparenthesis}
  We will prove the above facts in short order.

  \begin{enumerate}
  \item To show that $\Sheafify$ preserves finite limits, it suffices
    to show that the plus construction preserves finite limits in
    $\Psh{\mathbb{C}}$. Because finite limits in a Grothendieck topos
    are formed pointwise, it suffices to show that finite limits are
    preserved at the level of sets. But this condition is actually
    equivalent to the fact that the plus construction is a filtered
    colimit into $\Sets$, which we have already observed.
  \item Clearly $\iota$ is full and faithful, because it is the identity
    on morphisms.
  \item To show $\AreAdjoint{\Sheafify,\iota}$ ...
    
  \end{enumerate}
\end{proof}


\newpage
\section{Applications and examples}

We will now survey a few useful topologies.

\subsection{Dense and atomic topologies}

\begin{definition}[Dense topology]
  The \emph{dense topology} is defined as follows:
  \[
    \Define{
      \JDense(\Psi)
    }{
      \MkSet{
        \OBox{
          \IsSieve{\Psi}{S}
        }
        \mid
        \OBox{
          \forall\Of{\psi}{\Phi\to\Psi}.\
          \exists\Of{\phi}{X\to\Phi}.\
          \Member{\psi\circ \phi}{S(X)}
        }
      }
    }
  \]
\end{definition}

\begin{lem}
  When distilled into its pure essence as a Lawvere-Tierney local
  operator (Definition~\ref{def:lawvere-tierney}), the dense topology
  corresponds \textbf{classically} to the double-negation modality
  $\lnot\lnot$.\footnote{The definition of the dense topology that we
    have assumed is \emph{not}, however, equivalent to the double
    negation topology in a constructive metatheory, since the
    equivalence relies on De Morgan
    duality~\cite{spitters:2010,coquand:2013}.}
\end{lem}
\begin{proof}
  It suffices to ``compile'' double-negations from the internal
  language of the topos into statements about sieves. Recall that
  $\Member{S}{J(\Psi)}$ iff $\Forces{\Psi}{S=\top}$, where
  $\Define{\top}{\Yoneda{\Psi}}$ is the maximal sieve. First, we
  unfold the meaning of
  $\Forces{\Psi}{\lnot\lnot\IBox{\IsEq{S}{\top}}}$ using the
  Beth-Kripke-Joyal semantics of the topos as a weapon:
  \begin{gather}
    \Forces{\Psi}{\lnot\lnot\IBox{\IsEq{S}{\top}}}
    \\
    \forall\Of{\psi}{\Phi\to\Psi}.\
    \lnot(\Forces{\Phi}{\lnot\IBox{\IsEq{S\cdot\psi}{\top}}})
    \\
    \forall\Of{\psi}{\Phi\to\Psi}.\
    \lnot(
      \forall\Of{\phi}{X\to\Phi}.\
      \lnot(\Forces{X}{\IBox{\IsEq{S\cdot\psi\cdot\phi}{\top}}})
    )
    \label{de-morgan-1}
    \\
    \forall\Of{\psi}{\Phi\to\Psi}.\
    \exists\Of{\phi}{X\to \Phi}.\
    \Forces{X}{\IBox{\IsEq{S\cdot\psi\cdot\phi}{\top}}}
    \label{de-morgan-2}
    \\
    \forall\Of{\psi}{\Phi\to\Psi}.\
    \exists\Of{\phi}{X\to \Phi}.\
    \Forces{X}{\IBox{\IsEq{S\cdot(\psi\circ\phi)}{\top}}}
  \end{gather}
  %
  Now it suffices to show that
  $\Forces{X}{\IBox{\IsEq{S\cdot(\psi\circ\phi)}{\top}}}$ iff
  $\Member{\psi\circ\phi}{S(X)}$.
  %
  ($\Rightarrow$) Unfolding the meaning of our assumption, we have for
  all $\Of{\rho}{Y\to X}$ that
  $\Member{\psi\circ\phi\circ\rho}{S(Y)}$. Now choose $\Define{Y}{X}$
  and $\Define{\rho}{\ArrId{X}}$; therefore
  $\Member{\psi\circ\phi}{S(X)}$.
  %
  ($\Leftarrow$) Now suppose $\Member{\psi\circ\phi}{S(X)}$. We have
  to show that for all $\Of{\rho}{Y\to X}$, then
  $\Member{\psi\circ\phi\circ\rho}{S(Y)}$. This follows because sieves
  are closed under precomposition.
\end{proof}

\begin{remark}
  Observe the essential use of De Morgan's duality in the passage
  between~\ref{de-morgan-1}~and~\ref{de-morgan-2} above. The dense
  topology does \emph{not} correspond to the double negation topology
  in a constructive metatheory; moreover, the version of the dense
  topology which \emph{does} correspond to double negation often does
  not suffice for standard applications in a constructive metatheory,
  as the author observed
  in~\cite{sterling:math-stack-exchange-dense-topology}.
\end{remark}

\paragraph{Applications of the dense topology}
The most famous use of the dense topology \emph{qua} double negation
is in modern proofs of the independence of the Continuum
Hypothesis. Letting $\Of{\mathbb{P}}{\Posets}$ be a forcing poset, the
sheaves on the site $(\mathbb{P},\JDense)$ form a boolean topos from
which it is not difficult to obtain a model of ZFC in which the
continuum hypothesis fails. The reader is referred
to~\cite{maclane-moerdijk:1992} for a summary of this construction.

Another instance of the dense topology in practice is in its
incarnation as the \emph{atomic topology}, which can be imposed on any
site which satisfies the \emph{right Ore condition} defined below.

\begin{definition}[Ore condition]\label{def:ore}
  A category $\mathbb{C}$ satisfies the \emph{right Ore condition} if
  every pair of morphisms
  $\Of{\psi_0}{\Phi_0\to\Psi}$ and
  $\Of{\psi_1}{\Phi_1\to\Psi}$ can be completed into
  a commutative square:
  \[
    \begin{tikzcd}[sep=large]
      \OMode{\Phi}
      \arrow[r,dashed]
      \arrow[d,dashed]
      &
      \IMode{\Phi_0}
      \arrow[d,"\IMode{\psi_0}"]
      \\
      \IMode{\Phi_1}
      \arrow[r,swap,"\IMode{\psi_1}"]
      &
      \IMode{\Psi}
    \end{tikzcd}
  \]
  Having pullbacks is a sufficient condition, but not a necessary one.
\end{definition}

\begin{definition}[Atomic topology]
  If $\mathbb{C}$ satisfies the right Ore condition from
  Definition~\ref{def:ore}, then it is possible to impose the
  \emph{atomic topology} on $\mathbb{C}$, where all inhabited
  sieves\footnote{In classical sheaf theory, the covering sieves for
    the atomic topology are the \emph{non-empty} ones; however, in a
    constructive metatheory, this is not enough to develop the
    necessary results, including Lemma~\ref{lem:atomic-dense}.}  are
  covering:
  \[
    \Define{
      \JAtomic(\Psi)
    }{
      \MkSet{
        \OBox{\IsSieve{\Psi}{S}}
        \mid
        \OBox{\IsInh{\cup_\Phi S(\Phi)}}
      }
    }
  \]
\end{definition}

If the reader prefers to work with pretopologies or coverages, they
should be aware that the atomic topology is the one generated from
\emph{singleton} covering families.

\paragraph{Applications of the atomic topology}


Letting $\Of{\INJ}{\Cats}$ be the category of finite sets and only
injective maps between them, the topos of sheaves on the site
$(\OpCat{\INJ},\JAtomic)$ is known as the Schanuel topos, and is
equivalent to the category of nominal sets~\cite{pitts:2013}. Among
other things, the geometry and logic of the Schanuel topos accounts
for constructions which involve an \emph{abundance} of atomic names
which may be compared for equality.

It is helpful to consider what characteristics this sheaf subcategory
has which $\Psh{\OpCat{\INJ}}$ lacks. Because constructions within
this presheaf topos must be stable under only injective maps of name
contexts, it is clear that $\Psh{\OpCat{\INJ}}$ justifies operations
which depend on apartness of names.

In particular, defining the presheaf of ``available names''
$\Define{\mathbb{A}}{\Yoneda{\MkSet{\bullet}}}$ as the obvious
representable functor, we can define the following natural
transformation:
\begin{align*}
  \AOf{
    \mathit{test}
  }{
    \mathbb{A}\times\mathbb{A}\to \mathbf{2}
  }
  \\
  \ADefine{
    \mathit{test}_\Psi(\alpha,\beta)
  }{
    \begin{cases}
      \mathsf{t} &{\normalcolor\textbf{if } \IsEq{\alpha}{\beta}}
      \\
      \mathsf{f} &{\normalcolor\textbf{if } \IsNotEq{\alpha}{\beta}}
    \end{cases}
  }
\end{align*}
%
The above is well-defined/natural because injective maps are precisely
those which preserve apartness.


In fact, we can do even more and use Day's convolution to form a
\emph{separating product} and \emph{separating function space} in
$\Psh{\OpCat{\INJ}}$, adding a locally monoidal-closed structure which
is distinct from the standard locally cartesian closed structure of
the topos~\cite{schoepp-stark:2004}.

At the level of the logic, this corresponds with four new connectives,
$\MkSet{\FormatList{\IMode}{,}{*,\magicwand,\exists^*,\forall^*}}$
which are separating conjunction, separating implication, separating
existential quantification, and separating universal quantification
respectively.\footnote{Be cautious about trying to na\"ively develop
  this logic in the subobject lattice of the topos; Biering, Birkedal
  et al have shown that this construction degenerates into standard
  structural logic~\cite{biering-birkedal-torp-smith:2007}. However,
  at the very least, the separating quantifiers can be developed in a
  sensible way.}  We can also define a \emph{fresh name quantifier}
$\IMode{\newname x.\phi(x)}$ as
$\OMode{\forall^*x:\mathbb{A}.\phi(x)}$, but we will see that this
quantifier is not yet well-behaved.

In particular, this presheaf topos is not closed under a crucial
principle, which is the ``abundance'' of fresh names. In particular,
the principle $\IMode{(\newname x.\phi(\alpha))\supset\phi(\alpha)}$
fails to hold in the internal logic of $\Psh{\OpCat{\INJ}}$. This
principle, most properly understood as an instance of local character,
is precisely what the sheaf subcategory $\Sh{\OpCat{\INJ},\JAtomic}$
is closed under.

As soon as the atomic topology has been imposed, the ``freshness''
quantifier becomes self-dual, in the following sense:
\[
  \IMode{\exists^*x:\mathbb{A}.\phi(x,\alpha)}
  =
  \IMode{\newname x.\phi(x,\alpha)}
  =
  \IMode{\forall^*x:\mathbb{A}.\phi(x,\alpha)}
\]

\begin{lem}\label{lem:atomic-dense}
  The atomic topology coincides with the dense topology.
\end{lem}
\begin{proof}
  ($\Rightarrow$) Suppose $\Member{S}{\JAtomic(\Psi)}$, i.e.\
  $\IsSieve{\Psi}{S}$ and $\IsInh{\cup_\Phi S(\Phi)}$. Fix
  $\Of{\psi}{\Phi\to\Psi}$; we have to exhibit some
  $\Of{\phi}{X\to\Phi}$ such that $\Member{\psi\circ\phi}{S(X)}$.
  %
  By assumption, there is some $\Of{\Upsilon}{\mathbb{C}}$ for which we
  have some $\Of{\psi'}{\Upsilon\to\Psi}$ such that
  $\Member{\psi'}{S(\Upsilon)}$; by the right Ore condition
  (Definition~\ref{def:ore}), we have some $\Of{X}{\mathbb{C}}$ with
  the following property:
  \[
    \begin{tikzcd}
      \OMode{X}
      \arrow[r,dashed,"\OMode{\phi}"]
      \arrow[d,dashed,swap,"\OMode{\upsilon}"]
      &
      \IMode{\Phi}
      \arrow[d,"\IMode{\psi}"]
      \\
      \IMode{\Upsilon}
      \arrow[r,swap,"\IMode{\psi'}"]
      &
      \IMode{\Psi}
    \end{tikzcd}
  \]
  %
  Because sieves are closed under precomposition, we have
  $\Member{\psi'\circ \upsilon}{S(X)}$; because the diagram above
  commutes, we therefore have $\Member{\psi\circ\phi}{S(X)}$.

  ($\Leftarrow$) Suppose $\Member{S}{\JDense(\Psi)}$, i.e.\
  $\IsSieve{\Psi}{S}$ and for any $\Of{\psi}{\Phi\to\Psi}$ there
  exists some $\Of{\phi}{X\to\Phi}$ such that
  $\Member{\psi\circ\phi}{S(X)}$. We have to exhibit some
  $\Of{\Upsilon}{\mathbb{C}}$ together with some
  $\Of{\psi'}{\Upsilon\to\Psi}$ such that
  $\Member{\psi'}{S(\Upsilon)}$.
  %
  Choose $\Define{\Phi}{\Psi}$ and $\Define{\psi}{1}$; then, we have
  some $\Of{\phi}{X\to\Psi}$ such that $\Member{\phi}{S(X)}$. Then
  choose $\Define{\Upsilon}{X}$ and $\Define{\psi'}{\phi}$.

\end{proof}

\paragraph{Remark on constructivity}

One should be cautious about the numerous results in topos theory of
the form ``Any topos with property $X$ is boolean'' (e.g.\
``well-pointed''), which, far from elucidating an essential
consequence of the property $X$, merely expose a leakage of
information from the (Platonistic) external world into the topos. This
kind of glitch serves only to underscore the essentially Tarskian
deviation~\cite{girard:2011} which classical topos theory has
inherited from old-fashioned mathematics and semantics.

To resist this deviation amounts to adopting Bishop's dictum that
meaningful distinctions must be preserved; in doing so, we enter a
profoundly alien world in which, for instance, the Schanuel topos is
\emph{not} boolean. We do not take a strident position on this here;
our remarks are meant only to provide hope to the radical
constructivist that it is possible to use these tools without
incidentally committing oneself to a classical ontology.


\newpage

\bibliography{references/refs}
\bibliographystyle{abbrv}

\end{document}
